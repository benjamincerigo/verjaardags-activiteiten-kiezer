---
// ActivitySelector.astro
const { title, intro, activities, selectionKey = "2025-v1" } = Astro.props;
---

<main class="container">
  <h1>{title}</h1>
  <p class="intro-text">{intro}</p>
  <div class="input-container">
    <input type="date" id="birthdayDate" required />
  </div>
  <div class="input-container">
    <input
      type="text"
      id="fullName"
      placeholder="Vul je volledige naam in"
      required
    />
  </div>
  <button id="generateButton">Ik ben jarig!</button>
  <div id="result">
    <p class="celebration">ðŸŽŠ Gefeliciteerd! ðŸŽŠ</p>
    <p>Kies 1 activiteiten uit deze opties:</p>
    <div id="activities"></div>
  </div>
</main>

<script src="../scripts/activityGenerator.js"></script>

<script define:vars={{ activities, selectionKey }} type="module">
  import {
    generateActivitySelections,
    formatDate,
    hashCode,
  } from "./src/scripts/activityGenerator.js";

  document
    .getElementById("generateButton")
    .addEventListener("click", function () {
      const birthdayDate = document.getElementById("birthdayDate").value;
      const fullName = document.getElementById("fullName").value;

      if (!birthdayDate || !fullName) {
        alert("Vul alsjeblieft beide velden in!");
        return;
      }

      // Create a deterministic seed based on name, date and selection key
      const formattedDate = formatDate(birthdayDate);
      const seed = hashCode(
        fullName.toLowerCase() + formattedDate + selectionKey,
      );

      // Get selections using imported utility function
      const selected = generateActivitySelections(
        birthdayDate,
        fullName,
        activities,
      );

      const activitiesDiv = document.getElementById("activities");
      activitiesDiv.innerHTML = selected
        .map(
          (activity, index) =>
            `<div class="choice">${index + 1}. ${activity}</div>`,
        )
        .join("");

      document.getElementById("result").style.display = "block";
    });
</script>

<style>
  :root {
    --pico-border-radius: 2rem;
    --pico-form-element-spacing-vertical: 1rem;
    --pico-form-element-spacing-horizontal: 1.25rem;
  }
  main {
    margin-top: 2rem;
    text-align: center;
  }
  h1 {
    margin-bottom: 2rem;
  }
  #result {
    display: none;
    margin-top: 20px;
    padding: 20px;
    background-color: #f8fafc;
    border-radius: 5px;
  }
  .celebration {
    text-align: center;
    color: #2563eb;
    font-size: 1.2em;
    margin-bottom: 15px;
  }
</style>

<style is:global>
  .choice {
    margin: 10px 0;
    padding: 10px;
    background-color: white;
    border: 1px solid #e5e7eb;
    border-radius: 5px;
  }
</style>
